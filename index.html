<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Numpang Ngopi.crb ‚Äî Kasir</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    header { background: #1d899b; color: #fff; padding: 15px; text-align: center; }
    header h1 { margin: 0; font-size: 20px; }
    header p { margin: 5px 0 0; font-size: 14px; }

    main { padding: 15px; }
    .card { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card h2 { margin-top: 0; font-size: 18px; }

    button { background: #1d899b; color: #fff; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; margin: 5px 0; }
    button:hover { opacity: 0.9; }

    input { padding: 8px; border: 1px solid #ccc; border-radius: 6px; width: 100%; margin: 5px 0; }
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }

    .cart-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .summary p { margin: 5px 0; }
  </style>
</head>
<body>
  <header>
    <h1>Numpang Ngopi.crb ‚Äî Kasir</h1>
    <p>Sistem kasir sederhana untuk kedai</p>
  </header>

  <main>
    <!-- Menu -->
    <div class="card">
      <h2>Menu</h2>
      <div id="menu"></div>
      <button onclick="renderMenu()">Muat Ulang</button>
      <button onclick="addProductPrompt()">Tambah Produk</button>
    </div>

    <!-- Tambah Cepat Produk -->
    <div class="card">
      <h2>Tambah Cepat Produk</h2>
      <input type="text" id="quickName" placeholder="Nama produk">
      <input type="number" id="quickPrice" placeholder="Harga (contoh: 8000)">
      <button onclick="addQuickProduct()">Tambah</button>
      <p style="font-size:12px;color:#555;">Produk cepat tersimpan permanen di LocalStorage.</p>
    </div>

    <!-- Keranjang -->
    <div class="card">
      <h2>Keranjang</h2>
      <div id="cart"></div>
      <div class="summary">
        <p><strong>Total:</strong> Rp <span id="total">0</span></p>
        <p><strong>Pembayar:</strong></p>
        <input type="number" id="paidAmount" placeholder="Jumlah bayar">
        <p><strong>Kembalian:</strong> Rp <span id="change">0</span></p>
        <p><strong>Jumlah Item:</strong> <span id="itemCount">0</span></p>
      </div>
      <div class="btn-row">
        <button onclick="saveTransaction()">Simpan</button>
        <button onclick="clearCart()">Bersihkan</button>
        <button onclick="printReceipt()">Cetak Struk</button>
      </div>
    </div>
  </main>

  <script>
    // ---------------------------
    // Data menu default
    // ---------------------------
    let defaultMenu = [
      // Kopi
      { name: "Americano", price: 6000 },
      { name: "Kopi Susu Gula Aren", price: 8000 },
      { name: "Kopi Latte", price: 8000 },
      { name: "Kopi Susu Taro", price: 10000 },
      { name: "Kopi Susu Almond", price: 10000 },
      { name: "Kopi Mochachino", price: 10000 },
      // Non Kopi
      { name: "Taro", price: 5000 },
      { name: "Coklat", price: 5000 },
      { name: "Tarro Latte", price: 8000 },
      { name: "Chocolate", price: 8000 }
    ];

    let menu = [];

    function saveMenu() {
      localStorage.setItem("menuKasir", JSON.stringify(menu));
    }

    function loadMenu() {
      let saved = localStorage.getItem("menuKasir");
      if (saved) {
        menu = JSON.parse(saved);
      } else {
        menu = defaultMenu;
        saveMenu();
      }
    }

    // ---------------------------
    // Variabel keranjang
    // ---------------------------
    let cart = [];
    let total = 0;
    const menuDiv = document.getElementById("menu");
    const cartDiv = document.getElementById("cart");
    const totalSpan = document.getElementById("total");
    const itemCountSpan = document.getElementById("itemCount");
    const changeSpan = document.getElementById("change");
    const paidAmount = document.getElementById("paidAmount");

    // ---------------------------
    // Render Menu
    // ---------------------------
    function renderMenu() {
      menuDiv.innerHTML = "";
      menu.forEach((item, index) => {
        let btn = document.createElement("button");
        btn.textContent = `${item.name} (Rp${item.price})`;
        btn.onclick = () => addToCart(index);
        menuDiv.appendChild(btn);
      });
    }

    // Tambah Produk via Prompt
    function addProductPrompt() {
      let name = prompt("Nama produk:");
      let price = parseInt(prompt("Harga produk:"));
      if (name && price > 0) {
        menu.push({ name, price });
        saveMenu();
        renderMenu();
      }
    }

    // Tambah Produk Cepat
    function addQuickProduct() {
      let name = document.getElementById("quickName").value;
      let price = parseInt(document.getElementById("quickPrice").value);
      if (name && price > 0) {
        menu.push({ name, price });
        saveMenu();
        renderMenu();
        document.getElementById("quickName").value = "";
        document.getElementById("quickPrice").value = "";
      }
    }

    // ---------------------------
    // Keranjang
    // ---------------------------
    function addToCart(index) {
      let item = menu[index];
      let found = cart.find(c => c.name === item.name);
      if (found) {
        found.qty++;
      } else {
        cart.push({ ...item, qty: 1 });
      }
      refreshCart();
    }

    function refreshCart() {
      cartDiv.innerHTML = "";
      total = 0;
      let itemCount = 0;
      cart.forEach((item, i) => {
        let line = document.createElement("div");
        line.className = "cart-item";
        line.innerHTML = `${item.name} x${item.qty} - Rp${item.price * item.qty} 
          <button onclick="removeItem(${i})">Hapus</button>`;
        cartDiv.appendChild(line);
        total += item.price * item.qty;
        itemCount += item.qty;
      });
      totalSpan.textContent = total;
      itemCountSpan.textContent = itemCount;
      let change = (parseInt(paidAmount.value) || 0) - total;
      changeSpan.textContent = change >= 0 ? change : 0;
    }

    function removeItem(i) {
      cart.splice(i, 1);
      refreshCart();
    }

    function clearCart() {
      cart = [];
      refreshCart();
    }

    function saveTransaction() {
      alert("Transaksi disimpan (simulasi). Total: Rp " + total);
      clearCart();
      paidAmount.value = "";
    }

    // ---------------------------
    // Cetak Struk
    // ---------------------------
    function printReceipt() {
      let w = window.open('', '', 'width=400,height=600');
      let receipt = `
        <html>
          <head>
            <title>Struk Numpang Ngopi.crb</title>
            <style>
              body { font-family: monospace; padding: 10px; }
              h2 { text-align: center; margin-bottom: 10px; }
              hr { border: none; border-top: 1px dashed #000; margin: 10px 0; }
            </style>
          </head>
          <body>
            <h2>Numpang Ngopi.crb</h2>
            <div>${cart.map(item => `${item.name} - Rp${item.price} x ${item.qty} = Rp${item.price*item.qty}`).join("<br>")}</div>
            <hr>
            <p>Total: Rp ${total}</p>
            <p>Bayar: Rp ${paidAmount.value || 0}</p>
            <p>Kembali: Rp ${(paidAmount.value || 0) - total}</p>
            <hr>
            <p style="text-align:center;">Terima Kasih üôè</p>
          </body>
        </html>
      `;
      w.document.write(receipt);
      w.document.close();
      w.print();
    }

    // ---------------------------
    // Init
    // ---------------------------
    loadMenu();
    paidAmount.oninput = refreshCart;
    renderMenu();
    refreshCart();
  </script>
</body>
</html>
